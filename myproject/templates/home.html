{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
<header>
    <h2>Application Dashboard</h2>
    <div class="user-info">
        <span class="username">{{ username }}{% if user.is_superuser %} (SuperUser){% endif %}</span>
        <form method="POST" action="{% url 'logout' %}" class="logout-form">
            {% csrf_token %}
            <button type="submit">Logout</button>
        </form>
    </div>
</header>

<div class="container">
    <div class="sidebar">
        <h3>Topics</h3>
        <ul>
            {% for topic in topics %}
                <li><a href="{% url 'topic_detail' topic.name %}">{{ topic.name }}</a></li>
            {% empty %}
                <li>No topics available.</li>
            {% endfor %}
        </ul>
    </div>

    <div class="main-content">
        {% if error %}<p style="color:red;">{{ error }}</p>{% endif %}
        {% if success %}<p style="color:green;">{{ success }}</p>{% endif %}

        {% if user.is_superuser %}
            <h3>All Topic Requests</h3>
            {% if requests %}
                <table>
                    <thead>
                        <tr>
                            <th>Topic Name</th>
                            <th>Partitions</th>
                            <th>Requested By</th>
                            <th>Status</th>
                            <th>Requested At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for request in requests %}
                        <tr id="request-{{ request.id }}">
                            <td>{{ request.topic_name }}</td>
                            <td>{{ request.partitions }}</td>
                            <td>{{ request.requested_by.username }}</td>
                            <td>{{ request.status }}</td>
                            <td>{{ request.requested_at|date:"Y-m-d H:i T" }}</td>
                            <td>
                                {% if request.status == "PENDING" %}
                                <form method="POST" action="{% url 'handle_request' request.id %}" style="display:inline">
                                    {% csrf_token %}
                                    <button name="action" value="approve">Accept</button>
                                </form>
                                <form method="POST" action="{% url 'handle_request' request.id %}" style="display:inline">
                                    {% csrf_token %}
                                    <button name="action" value="decline">Decline</button>
                                </form>
                                {% else %}-{% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No requests found.</p>
            {% endif %}

            <h3>Create New Topic</h3>
            <form method="POST" action="{% url 'create_topic' %}">
                {% csrf_token %}
                <input type="text" name="topic_name" placeholder="Topic Name" required>
                <input type="number" name="partitions" placeholder="Number of Partitions" min="1" required>
                <button type="submit">Create Topic</button>
            </form>

        {% else %}
            <h3>Request Topic Creation</h3>
            <form method="POST">
                {% csrf_token %}
                <input type="text" name="topic_name" placeholder="Topic Name" required>
                <input type="number" name="partitions" placeholder="Number of Partitions" min="1" required>
                <button type="submit">Submit Request</button>
            </form>

            <h3>Your Requests</h3>
            {% if requests %}
            <table>
                <thead>
                    <tr>
                        <th>Topic Name</th>
                        <th>Partitions</th>
                        <th>Status</th>
                        <th>Requested At</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in requests %}
                    <tr>
                        <td>{{ request.topic_name }}</td>
                        <td>{{ request.partitions }}</td>
                        <td>{{ request.status }}</td>
                        <td>{{ request.requested_at|date:"Y-m-d H:i T" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>You have no requests yet.</p>
            {% endif %}
        {% endif %}
    </div>
</div>
</body>
</html>
